{% extends 'back/basem.html.twig' %}

{% block title %}Détails Plan d'Action - {{ plan_actions.decision }}{% endblock %}

{% block body %}
<div class="page-title" style="background-color: #9dbbce; padding: 20px 0;">
  <div class="container d-lg-flex justify-content-between align-items-center">
    <h1 class="mb-2 mb-lg-0" style="color: #102c59; font-weight: 700;">Détails Plan d'Action</h1>
    <nav class="breadcrumbs">
      <ol style="list-style: none; padding: 0; margin: 0; display: flex; gap: 10px;">
        <li><a href="{{ path('back_home') }}" style="color: #102c59; text-decoration: none;">Accueil</a></li>
        <li><a href="{{ path('app_plan_actions_index') }}" style="color: #102c59; text-decoration: none;">Plans d'Actions</a></li>
        <li style="color: #d52e28;">› Détails</li>
      </ol>
    </nav>
  </div>
</div>

<section class="section" style="padding: 40px 0;">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card" style="border: 1px solid #9dbbce; border-radius: 8px; box-shadow: 0 4px 12px rgba(16, 44, 89, 0.1);">
          <div class="card-body p-4">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="mb-0" style="color: #102c59;">{{ plan_actions.decision }}</h2>
              <span class="badge" style="
                {% if plan_actions.statut.value == 'EN_ATTENTE' %}
                  background-color: #ffc107; color: #000;
                {% elseif plan_actions.statut.value == 'EN_COURS' %}
                  background-color: #9dbbce; color: #102c59;
                {% elseif plan_actions.statut.value == 'FINI' %}
                  background-color: #28a745; color: white;
                {% else %}
                  background-color: #d52e28; color: white;
                {% endif %}
                padding: 8px 16px; font-weight: 600; border-radius: 20px; font-size: 0.9rem;
              ">
                {{ plan_actions.statut.value|replace({'_': ' '})|title }}
              </span>
            </div>
            
            <div class="mb-4">
              <p style="color: #102c59; opacity: 0.8; margin-bottom: 1.5rem;">
                <i class="bi bi-calendar me-1" style="color: #102c59;"></i>
                Date du plan : <strong>{{ plan_actions.date|date('d/m/Y') }}</strong>
                {% if plan_actions.updatedAt %}
                  <span style="margin-left: 15px;">
                    <i class="bi bi-clock-history me-1" style="color: #102c59;"></i>
                    Modifié le <strong>{{ plan_actions.updatedAt|date('d/m/Y H:i') }}</strong>
                  </span>
                {% endif %}
              </p>
            </div>
            
            <div class="mb-4">
              <h5 class="fw-bold" style="color: #102c59; margin-bottom: 15px;">Description</h5>
              <div class="p-3 rounded" style="background-color: rgba(157, 187, 206, 0.1); border: 1px solid #9dbbce; color: #102c59;">
                {{ plan_actions.description|nl2br }}
              </div>
            </div>
            
            <div class="row mb-4">
              <div class="col-md-6">
                <h5 class="fw-bold" style="color: #102c59; margin-bottom: 10px;">Catégorie</h5>
                <p class="mb-0">
                  {% if plan_actions.categorie %}
                    <span class="badge" style="background-color: #9dbbce; color: #102c59; padding: 6px 12px; font-weight: 500;">
                      {{ plan_actions.categorie.value }}
                    </span>
                  {% else %}
                    <span style="color: #102c59; opacity: 0.7;">Non catégorisé</span>
                  {% endif %}
                </p>
              </div>
              <div class="col-md-6">
                <h5 class="fw-bold" style="color: #102c59; margin-bottom: 10px;">Date du plan</h5>
                <p class="mb-0" style="color: #102c59;">{{ plan_actions.date ? plan_actions.date|date('d/m/Y') : 'Non spécifié' }}</p>
              </div>
            </div>
            
            {% if plan_actions.sortieAI %}
            <div class="row mb-4">
              <div class="col-md-12">
                <h5 class="fw-bold" style="color: #102c59; margin-bottom: 10px;">Sortie AI associée</h5>
                <p class="mb-0" style="color: #102c59; padding: 12px; background-color: rgba(157, 187, 206, 0.1); border-radius: 6px; border-left: 4px solid #9dbbce;">
                  {{ plan_actions.sortieAI }}
                </p>
              </div>
            </div>
            {% endif %}
            
            {% if plan_actions.feedbackEnseignant %}
            <div class="row mb-4">
              <div class="col-md-12">
                <h5 class="fw-bold" style="color: #102c59; margin-bottom: 10px;">Feedback enseignant</h5>
                <div class="p-3 rounded" style="background-color: rgba(157, 187, 206, 0.1); border: 1px solid #9dbbce; color: #102c59;">
                  {{ plan_actions.feedbackEnseignant|nl2br }}
                </div>
                {% if plan_actions.feedbackDate %}
                  <p style="color: #102c59; opacity: 0.7; margin-top: 10px; margin-bottom: 0;">
                    <small>
                      <i class="bi bi-calendar me-1"></i>
                      {{ plan_actions.feedbackDate|date('d/m/Y H:i') }}
                      {% if plan_actions.feedbackAuteur %}
                        par <strong>{{ plan_actions.feedbackAuteur.nom }} {{ plan_actions.feedbackAuteur.prenom }}</strong>
                      {% endif %}
                    </small>
                  </p>
                {% endif %}
              </div>
            </div>
            {% endif %}
            
            <div class="d-flex justify-content-between mt-4 pt-3 border-top" style="border-color: #9dbbce !important;">
              <a href="{{ path('app_plan_actions_index') }}" class="btn" style="border: 1px solid #9dbbce; color: #102c59; border-radius: 6px; padding: 10px 25px;">
                <i class="bi bi-arrow-left me-1"></i> Retour à la liste
              </a>
              
              <div>
                <a href="{{ path('app_plan_actions_edit', {'id': plan_actions.id}) }}" 
                   class="btn me-2" style="background-color: #102c59; color: white; border: none; border-radius: 6px; padding: 10px 25px;">
                  <i class="bi bi-pencil me-1"></i> Modifier
                </a>
                
                <form method="post" action="{{ path('app_plan_actions_delete', {'id': plan_actions.id}) }}" 
                      style="display:inline;" 
                      onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce plan d\'action ?');">
                  <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ plan_actions.id) }}">
                  <button type="submit" class="btn" style="background-color: #d52e28; color: white; border: none; border-radius: 6px; padding: 10px 25px;">
                    <i class="bi bi-trash me-1"></i> Supprimer
                  </button>
                </form>
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
.card {
  border-radius: 12px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(16, 44, 89, 0.15);
}

.badge {
  font-weight: 500;
  padding: 0.35em 0.65em;
  font-size: 0.85em;
  transition: all 0.3s ease;
}

.btn {
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn[style*="background-color: #102c59"]:hover {
  background-color: #0a1f3f !important;
}

.btn[style*="background-color: #d52e28"]:hover {
  background-color: #b32520 !important;
}

.btn[style*="border: 1px solid #9dbbce"]:hover {
  background-color: rgba(157, 187, 206, 0.1);
  color: #102c59;
}

h5.fw-bold {
  position: relative;
  padding-bottom: 8px;
}

h5.fw-bold::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 40px;
  height: 3px;
  background-color: #9dbbce;
  border-radius: 2px;
}

.bi {
  vertical-align: middle;
}

.rounded {
  border-radius: 8px;
}

.border-top {
  border-top-width: 2px !important;
}

form {
  display: inline;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Animation d'entrée pour la carte
  const card = document.querySelector('.card');
  if (card) {
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, 100);
  }
  
  // Effet de confirmation pour les boutons d'action
  const actionButtons = document.querySelectorAll('a.btn, button.btn');
  actionButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      // Petite animation de clic
      this.style.transform = 'scale(0.98)';
      setTimeout(() => {
        this.style.transform = 'scale(1)';
      }, 150);
    });
  });
  
  // Effet pour le bouton de suppression
  const deleteButton = document.querySelector('button[style*="background-color: #d52e28"]');
  if (deleteButton) {
    deleteButton.addEventListener('mouseover', function() {
      this.style.boxShadow = '0 4px 8px rgba(213, 46, 40, 0.3)';
    });
    
    deleteButton.addEventListener('mouseout', function() {
      this.style.boxShadow = 'none';
    });
  }
  
  // Mise en évidence des sections
  const sections = document.querySelectorAll('.row.mb-4');
  sections.forEach(section => {
    section.addEventListener('mouseenter', function() {
      this.style.backgroundColor = 'rgba(157, 187, 206, 0.05)';
      this.style.borderRadius = '8px';
      this.style.padding = '10px';
      this.style.transition = 'background-color 0.3s ease';
    });
    
    section.addEventListener('mouseleave', function() {
      this.style.backgroundColor = 'transparent';
      this.style.padding = '0';
    });
  });
  
  // Copier la décision au clic
  const decisionTitle = document.querySelector('h2.mb-0');
  if (decisionTitle) {
    decisionTitle.style.cursor = 'pointer';
    decisionTitle.title = 'Cliquer pour copier';
    
    decisionTitle.addEventListener('click', function() {
      const textToCopy = this.textContent;
      navigator.clipboard.writeText(textToCopy).then(() => {
        // Feedback visuel
        const originalText = this.textContent;
        this.textContent = '✓ Copié !';
        this.style.color = '#28a745';
        
        setTimeout(() => {
          this.textContent = originalText;
          this.style.color = '#102c59';
        }, 1500);
      });
    });
  }
});
</script>
{% endblock %}