{% extends 'back/basem.html.twig' %}

{% block title %}Modifier Catégorie - {{ categorie.nomCategorie }}{% endblock %}

{% block body %}
<div class="page-title" style="background-color: #9dbbce; padding: 20px 0;">
  <div class="container d-lg-flex justify-content-between align-items-center">
    <h1 class="mb-2 mb-lg-0" style="color: #102c59; font-weight: 700;">Modifier Catégorie</h1>
    <nav class="breadcrumbs">
      <ol style="list-style: none; padding: 0; margin: 0; display: flex; gap: 10px;">
        <li><a href="{{ path('back_home') }}" style="color: #102c59; text-decoration: none;">Accueil</a></li>
        <li><a href="{{ path('app_categorie_article_index') }}" style="color: #102c59; text-decoration: none;">Catégories</a></li>
        <li style="color: #d52e28;">› Modifier</li>
      </ol>
    </nav>
  </div>
</div>

<section class="section" style="padding: 40px 0;">
  <div class="container">
    
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card" style="border: 1px solid #9dbbce; border-radius: 8px; box-shadow: 0 4px 12px rgba(16, 44, 89, 0.1);">
          <div class="card-body p-4">
            
            <div class="text-center mb-4">
              <h2 class="mb-1" style="color: #102c59;">Modifier la Catégorie</h2>
              <p style="color: #102c59; opacity: 0.8;">Mettez à jour les informations de la catégorie</p>
            </div>

            <!-- Flash Messages -->
            {% for label, messages in app.flashes %}
              {% for message in messages %}
                <div class="alert alert-dismissible fade show mb-4" style="
                  {% if label == 'error' or label == 'danger' %}
                    background-color: rgba(213, 46, 40, 0.1); border-color: #d52e28; color: #d52e28;
                  {% elseif label == 'success' %}
                    background-color: rgba(40, 167, 69, 0.1); border-color: #28a745; color: #28a745;
                  {% else %}
                    background-color: rgba(157, 187, 206, 0.2); border-color: #9dbbce; color: #102c59;
                  {% endif %}
                  border-left: 4px solid {% if label == 'error' or label == 'danger' %}#d52e28{% elseif label == 'success' %}#28a745{% else %}#102c59{% endif %};
                  border-radius: 6px;
                ">
                  <i class="bi bi-{{ label == 'error' or label == 'danger' ? 'exclamation' : 'check' }}-circle me-2"></i>
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" style="color: #102c59;"></button>
                </div>
              {% endfor %}
            {% endfor %}

            <form method="post" class="needs-validation" novalidate>
              {{ form_start(form) }}
              
              <div class="mb-4">
                <label for="{{ form.nomCategorie.vars.id }}" class="form-label fw-bold" style="color: #102c59;">
                  Nom de la catégorie <span style="color: #d52e28;">*</span>
                </label>
                {{ form_widget(form.nomCategorie, {
                  'attr': {
                    'class': 'form-control' ~ (form.nomCategorie.vars.errors|length ? ' is-invalid' : ''),
                    'placeholder': 'Ex: Pédagogie, Orientation, Psychologie...',
                    'style': 'border-color: #9dbbce; border-radius: 6px;'
                  }
                }) }}
                <div class="invalid-feedback" style="color: #d52e28;">
                  {{ form_errors(form.nomCategorie) }}
                </div>
              </div>

              <div class="mb-4">
                <label for="{{ form.description.vars.id }}" class="form-label fw-bold" style="color: #102c59;">
                  Description
                </label>
                {{ form_widget(form.description, {
                  'attr': {
                    'class': 'form-control' ~ (form.description.vars.errors|length ? ' is-invalid' : ''),
                    'rows': '4',
                    'placeholder': 'Décrivez le type d\'articles de cette catégorie...',
                    'style': 'border-color: #9dbbce; border-radius: 6px;'
                  }
                }) }}
                <div class="invalid-feedback" style="color: #d52e28;">
                  {{ form_errors(form.description) }}
                </div>
              </div>

              <div class="mb-4 p-3 rounded" style="background-color: rgba(157, 187, 206, 0.1); border: 1px solid #9dbbce;">
                <h6 class="fw-bold" style="color: #102c59; margin-bottom: 15px;">
                  <i class="bi bi-info-circle me-2" style="color: #102c59;"></i>
                  Informations système
                </h6>
                <div class="row">
                  <div class="col-md-6">
                    <p class="mb-1"><small style="color: #102c59; opacity: 0.7;">Créée le:</small></p>
                    <p style="color: #102c59; font-weight: 500;">{{ categorie.createdAt ? categorie.createdAt|date('d/m/Y H:i') : 'Non spécifié' }}</p>
                  </div>
                  <div class="col-md-6">
                    <p class="mb-1"><small style="color: #102c59; opacity: 0.7;">Créée par:</small></p>
                    <p style="color: #102c59; font-weight: 500;">
                      {% if categorie.auteur %}
                        {{ categorie.auteur.nom }} {{ categorie.auteur.prenom }}
                      {% else %}
                        Non spécifié
                      {% endif %}
                    </p>
                  </div>
                </div>
              </div>

              <div class="d-flex justify-content-between mt-4 pt-3 border-top" style="border-color: #9dbbce !important;">
                <a href="{{ path('app_categorie_article_index') }}" class="btn" style="border: 1px solid #9dbbce; color: #102c59; border-radius: 6px; padding: 10px 25px;">
                  <i class="bi bi-arrow-left me-1"></i> Annuler
                </a>
                <button type="submit" class="btn" style="background-color: #d52e28; color: white; border: none; border-radius: 6px; padding: 10px 25px; font-weight: 600;">
                  <i class="bi bi-check-circle me-1"></i> Enregistrer
                </button>
              </div>

              {{ form_end(form) }}
            </form>
            
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<style>
.card {
  border-radius: 12px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(16, 44, 89, 0.15);
}

.form-label {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.form-control, .form-select {
  border: 2px solid #9dbbce;
  border-radius: 8px;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  border-color: #102c59;
  box-shadow: 0 0 0 0.25rem rgba(16, 44, 89, 0.25);
  outline: none;
}

.btn {
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn[style*="background-color: #d52e28"]:hover {
  background-color: #b32520 !important;
}

.btn[style*="border: 1px solid #9dbbce"]:hover {
  background-color: rgba(157, 187, 206, 0.1);
  color: #102c59;
}

.was-validated .form-control:invalid,
.was-validated .form-select:invalid {
  border-color: #d52e28;
}

.was-validated .form-control:valid,
.was-validated .form-select:valid {
  border-color: #28a745;
}

.invalid-feedback {
  display: none;
  width: 100%;
  margin-top: 0.25rem;
  font-size: 0.875em;
}

.was-validated .form-control:invalid ~ .invalid-feedback,
.was-validated .form-select:invalid ~ .invalid-feedback {
  display: block;
}

.bi {
  vertical-align: middle;
}

.rounded {
  border-radius: 8px;
}

.border-top {
  border-top-width: 2px !important;
}

.btn-close {
  filter: invert(18%) sepia(50%) saturate(3000%) hue-rotate(200deg) brightness(30%) contrast(100%);
}

.btn-close:hover {
  filter: invert(15%) sepia(80%) saturate(5000%) hue-rotate(350deg) brightness(90%) contrast(100%);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Validation côté client
  const forms = document.querySelectorAll('.needs-validation');
  
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
  
  // Animation d'entrée pour la carte
  const card = document.querySelector('.card');
  if (card) {
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, 100);
  }
});
</script>
{% endblock %}