{% extends 'back/base.html.twig' %}

{% block title %}Objectifs des utilisateurs{% endblock %}

{% block body %}
<!-- Page Title -->
<div class="page-title light-background">
  <div class="container d-lg-flex justify-content-between align-items-center">
    <h1 class="mb-2 mb-lg-0 text-primary">Objectifs des utilisateurs</h1>
    <nav class="breadcrumbs">
      <ol>
        <li><a href="{{ path('back_home') }}">Accueil</a></li>
        <li class="current">Objectifs</li>
      </ol>
    </nav>
  </div>
</div>

<section class="section">
  <div class="container">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0 text-secondary">Liste des utilisateurs</h2>
      <div class="input-group w-50">
        <span class="input-group-text bg-white border-end-0">
          <i class="bi bi-search"></i>
        </span>
        <input type="text" class="form-control border-start-0" placeholder="Rechercher par nom ou email..." id="searchInput">
      </div>
    </div>

    <!-- Compteur -->
    <div class="mb-3">
      <small class="text-muted">
        Affichage de <strong id="resultCount">{{ utilisateurs|length }}</strong> utilisateur(s)
      </small>
    </div>

    <!-- Tableau -->
    <div class="card shadow-sm border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0" id="usersTable">
            <thead style="background-color: #eef3f7;">
              <tr class="text-secondary">
                <th>#</th>
                <th>Utilisateur</th>
                <th>Email</th>
                <th class="text-end">Action</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              {% for utilisateur in utilisateurs %}
              <tr class="data-row">
                <td>{{ utilisateur.id }}</td>
                <td>
                  <strong>{{ utilisateur.prenom }} {{ utilisateur.nom }}</strong>
                  <br><small class="text-muted">ID: {{ utilisateur.id }}</small>
                </td>
                <td>
                  <a href="mailto:{{ utilisateur.email }}">{{ utilisateur.email }}</a>
                </td>
                <td class="text-end">
                  <a href="{{ path('back_events', {'utilisateurId': utilisateur.id}) }}" 
                     class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye me-1"></i> Voir les objectifs
                  </a>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="4" class="text-center text-muted py-5">
                  <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                  <p class="mt-3">Aucun utilisateur trouv√©</p>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Recherche JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('searchInput');
  const resultCount = document.getElementById('resultCount');
  const rows = Array.from(document.querySelectorAll('.data-row'));

  if (searchInput) {
    searchInput.addEventListener('keyup', function() {
      const term = this.value.toLowerCase().trim();
      let visible = 0;

      rows.forEach(row => {
        const match = row.textContent.toLowerCase().includes(term);
        row.style.display = match ? '' : 'none';
        if (match) visible++;
      });

      resultCount.textContent = visible;
    });
  }
});
</script>

{% endblock %}