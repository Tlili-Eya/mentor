{% extends 'back/basem.html.twig' %}

{% block title %}
    Modifier le Plan d'Action - {{ plan_actions.decision }}
{% endblock %}

{% block body %}
<div class="page-title" style="background-color: #f0f6fa;">
  <div class="container d-lg-flex justify-content-between align-items-center">
    <h1 class="mb-2 mb-lg-0" style="color: #102c59;">Modifier le Plan d'Action</h1>
    <nav class="breadcrumbs">
      <ol>
        <li><a href="{{ path('back_home') }}">Accueil</a></li>
        <li><a href="{{ path('app_plan_actions_index') }}">Plans d'Actions</a></li>
        <li class="current" style="color: #d52e28;">Modifier</li>
      </ol>
    </nav>
  </div>
</div>

<section class="section">
  <div class="container">
    
    {% for message in app.flashes('success') %}
      <div class="alert alert-success alert-dismissible fade show" role="alert" style="border-left: 4px solid #28a745;">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}

    <div class="row justify-content-center">
      <div class="col-lg-8">
        
        <!-- Header avec titre principal -->
        <div class="text-center mb-5">
          <h2 class="mb-3" style="color: #102c59;">Modifier le Plan d'Action</h2>
          <p class="text-muted">Modifiez les informations de votre plan d'action</p>
        </div>

        <div class="card shadow-sm border-0" style="border-radius: 12px; border: 1px solid #e0e0e0;">
          <div class="card-body p-4">
            
            {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}
            
            <!-- Décision -->
            <div class="mb-4">
              <label class="form-label fw-bold" style="color: #102c59;">Décision <span style="color: #d52e28;">*</span></label>
              {{ form_widget(form.decision, {
                'attr': {
                  'class': 'form-control',
                  'style': 'border: 2px solid #9dbbce; border-radius: 8px;',
                  'placeholder': 'Ex: Mettre en place une nouvelle stratégie pédagogique'
                }
              }) }}
              <div class="invalid-feedback">
                {{ form_errors(form.decision) }}
              </div>
            </div>
            
            <!-- Description détaillée -->
            <div class="mb-4">
              <label class="form-label fw-bold" style="color: #102c59;">Description détaillée <span style="color: #d52e28;">*</span></label>
              {{ form_widget(form.description, {
                'attr': {
                  'class': 'form-control',
                  'style': 'border: 2px solid #9dbbce; border-radius: 8px;',
                  'rows': 4,
                  'placeholder': 'Rédigez le contenu complet du plan d\'action...'
                }
              }) }}
              <div class="invalid-feedback">
                {{ form_errors(form.description) }}
              </div>
            </div>
            
            <!-- Deux colonnes pour Statut et Catégorie -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label fw-bold" style="color: #102c59;">Statut <span style="color: #d52e28;">*</span></label>
                  {{ form_widget(form.statut, {
                    'attr': {
                      'class': 'form-select form-select-lg',
                      'style': 'border: 2px solid #9dbbce; border-radius: 8px;'
                    }
                  }) }}
                  <div class="invalid-feedback">
                    {{ form_errors(form.statut) }}
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label fw-bold" style="color: #102c59;">Catégorie <span style="color: #d52e28;">*</span></label>
                  {{ form_widget(form.categorie, {
                    'attr': {
                      'class': 'form-select form-select-lg',
                      'style': 'border: 2px solid #9dbbce; border-radius: 8px;'
                    }
                  }) }}
                  <div class="invalid-feedback">
                    {{ form_errors(form.categorie) }}
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Date -->
            <div class="mb-4">
              <label class="form-label fw-bold" style="color: #102c59;">Date <span style="color: #d52e28;">*</span></label>
              {{ form_widget(form.date, {
                'attr': {
                  'class': 'form-control form-control-lg',
                  'style': 'border: 2px solid #9dbbce; border-radius: 8px;',
                  'placeholder': 'jj/mm/aaaa'
                }
              }) }}
              <div class="invalid-feedback">
                {{ form_errors(form.date) }}
              </div>
            </div>
            
            <!-- Information note -->
            <div class="alert alert-info mt-4 mb-4" style="background-color: #e8f4fc; border-color: #9dbbce; color: #102c59; border-radius: 8px; border-left: 4px solid #102c59;">
              <i class="bi bi-info-circle me-2"></i>
              <strong>Information :</strong> Les modifications seront appliquées immédiatement.
            </div>

            <!-- Boutons d'action -->
            <div class="d-flex justify-content-between mt-4 pt-3 border-top">
              <div>
                <a href="{{ path('app_plan_actions_index') }}" class="btn btn-outline-secondary" style="border-color: #9dbbce; color: #102c59; border-radius: 8px;">
                  <i class="bi bi-arrow-left me-1"></i> Retour
                </a>
                <a href="{{ path('app_plan_actions_show', {'id': plan_actions.id}) }}" 
                   class="btn btn-outline-info ms-2" style="border-color: #9dbbce; color: #102c59; border-radius: 8px;">
                  <i class="bi bi-eye me-1"></i> Voir
                </a>
              </div>
              
              <div>
                <button type="submit" class="btn btn-lg" style="background-color: #d52e28; border-color: #d52e28; color: white; border-radius: 8px; font-weight: 600;">
                  <i class="bi bi-save me-1"></i> Mettre à jour
                </button>
              </div>
            </div>
            
            {{ form_end(form) }}
            
          </div>
        </div>

        <!-- Navigation footer -->
        <div class="mt-4 text-center">
          <nav class="nav justify-content-center">
            <a class="nav-link" href="#" style="color: #102c59;">
              <i class="bi bi-clipboard-check me-1"></i> Plan d'actions
            </a>
            <a class="nav-link" href="#" style="color: #102c59;">
              <i class="bi bi-file-text me-1"></i> Articles
            </a>
            <a class="nav-link" href="#" style="color: #102c59;">
              <i class="bi bi-tag me-1"></i> Catégorie
            </a>
            <a class="nav-link" href="#" style="color: #102c59;">
              <i class="bi bi-window me-1"></i> Front Office
            </a>
          </nav>
        </div>
        
      </div>
    </div>
  </div>
</section>

<style>
.page-title {
  padding: 2rem 0;
  margin-bottom: 2rem;
}

.breadcrumbs ol {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
}

.breadcrumbs li {
  margin-right: 0.5rem;
}

.breadcrumbs li:not(:last-child)::after {
  content: "/";
  margin-left: 0.5rem;
  color: #9dbbce;
}

.breadcrumbs a {
  color: #102c59;
  text-decoration: none;
}

.breadcrumbs a:hover {
  color: #d52e28;
  text-decoration: underline;
}

.form-label {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.form-control, .form-select {
  padding: 0.75rem 1rem;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control-lg, .form-select-lg {
  padding: 1rem;
  font-size: 1.1rem;
}

.form-control:focus, .form-select:focus {
  border-color: #102c59 !important;
  box-shadow: 0 0 0 0.25rem rgba(16, 44, 89, 0.25);
  outline: none;
}

.btn-outline-secondary:hover, .btn-outline-info:hover {
  background-color: #9dbbce;
  border-color: #9dbbce;
  color: #102c59;
}

.nav-link {
  font-weight: 500;
  transition: color 0.3s;
}

.nav-link:hover {
  color: #d52e28 !important;
}

.text-muted {
  color: #6c757d !important;
}

hr {
  border-top: 2px solid #9dbbce;
  opacity: 0.5;
}

.alert-success {
  border-radius: 8px;
  background-color: #f6ffed;
  border-color: #b7eb8f;
  color: #102c59;
}

.btn-close:focus {
  box-shadow: 0 0 0 0.25rem rgba(213, 46, 40, 0.25);
}

/* Style pour les selects */
.form-select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23102c59' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
}

/* Animation pour le bouton principal */
.btn[style*="background-color: #d52e28"]:hover {
  background-color: #b32520 !important;
  border-color: #b32520 !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(213, 46, 40, 0.3);
}

.btn[style*="background-color: #d52e28"] {
  transition: all 0.3s ease;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Validation côté client
  const forms = document.querySelectorAll('.needs-validation');
  
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      form.classList.add('was-validated');
    }, false);
  });
  
  // Prévenir la fermeture accidentelle si des modifications ont été faites
  let formChanged = false;
  const form = document.querySelector('form');
  const initialFormData = new FormData(form);
  
  // Détecter les changements dans le formulaire
  form.querySelectorAll('input, select, textarea').forEach(element => {
    element.addEventListener('change', () => {
      formChanged = true;
    });
    
    element.addEventListener('input', () => {
      formChanged = true;
    });
  });
  
  // Avertir avant de quitter si des modifications non sauvegardées
  window.addEventListener('beforeunload', (event) => {
    if (formChanged) {
      event.preventDefault();
      event.returnValue = 'Vous avez des modifications non sauvegardées. Êtes-vous sûr de vouloir quitter ?';
    }
  });
  
  // Réinitialiser le drapeau de changement lors de la soumission
  form.addEventListener('submit', () => {
    formChanged = false;
  });
  
  // Ajouter des styles de validation
  const style = document.createElement('style');
  style.textContent = `
    .is-valid {
      border-color: #28a745 !important;
    }
    
    .is-invalid {
      border-color: #d52e28 !important;
    }
    
    .invalid-feedback {
      color: #d52e28;
      font-size: 0.875em;
      margin-top: 0.25rem;
    }
  `;
  document.head.appendChild(style);
});
</script>
{% endblock %}