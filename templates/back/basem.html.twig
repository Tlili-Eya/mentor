<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>
			{% block title %}MentorAI - Back Office{% endblock %}
		</title>
		<meta name="description" content="{% block meta_description %}{% endblock %}">

		<!-- Favicons -->
		<link rel="icon" href="{{ asset('assets/img/favicon.png') }}">
		<link rel="apple-touch-icon" href="{{ asset('assets/img/apple-touch-icon.png') }}">

		<!-- Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Roboto&family=Raleway&family=Ubuntu&display=swap" rel="stylesheet">

		<!-- Vendor CSS -->
		<link rel="stylesheet" href="{{ asset('assets/vendor/bootstrap/css/bootstrap.min.css') }}">
		<link rel="stylesheet" href="{{ asset('assets/vendor/bootstrap-icons/bootstrap-icons.css') }}">
		<link rel="stylesheet" href="{{ asset('assets/vendor/aos/aos.css') }}">
		<link rel="stylesheet" href="{{ asset('assets/vendor/swiper/swiper-bundle.min.css') }}">

		<!-- Main CSS -->
		<link rel="stylesheet" href="{{ asset('assets/css/main.css') }}"> 
		{% block stylesheets %}{% endblock %}

		<style>
			/* Styles pour les boutons d'authentification */
			.auth-buttons {
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}
			.auth-buttons .btn-getstarted, .auth-buttons .btn-outline-danger, .auth-buttons .btn-warning {
				padding: 8px 20px;
				border-radius: 50px;
				transition: all 0.3s ease;
				font-weight: 500;
				display: inline-flex;
				align-items: center;
				white-space: nowrap;
				text-decoration: none;
			}
			@media(max-width: 1200px) {
				.auth-buttons {
					margin-top: 1rem;
				}
			}

			/* Global MentorUI styles */
			.toast-container { z-index: 2000; }
			.premium-toast { background: rgba(255, 255, 255, 0.95) !important; backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.1) !important; border-radius: 1rem !important; box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1) !important; }
			.toast-progress { position: absolute; bottom: 0; left: 0; height: 3px; background: rgba(0, 0, 0, 0.05); width: 100%; }
			.toast-progress-inner { height: 100%; width: 100%; border-bottom-left-radius: 1rem; animation: toast-progress-anim linear forwards; }
			@keyframes toast-progress-anim { from { width: 100%; } to { width: 0%; } }
			.bg-soft-danger { background-color: rgba(220, 53, 69, 0.1) !important; color: #dc3545 !important; }
			.bg-soft-success { background-color: rgba(25, 135, 84, 0.1) !important; color: #198754 !important; }
		</style>
	</head>

	<body>
		<!-- ======= HEADER ======= -->
		<header id="header" class="header d-flex align-items-center sticky-top">
			<div class="container-fluid container-xl position-relative d-flex align-items-center">

				<a href="{{ path('app_admin_dashboard') }}" class="logo d-flex align-items-center">
					<img src="{{ asset('assets/img/123.png') }}" alt="MentorAI Logo">
				</a>

				<nav id="navmenu" class="navmenu mx-auto">
					<ul>
						<li><a href="{{ path('app_plan_actions_index') }}" {% if 'plan_actions' in app.request.get('_route') %}class="active"{% endif %}>Plan d'actions</a></li>
						<li><a href="{{ path('app_reference_article_index') }}" {% if 'reference_article' in app.request.get('_route') %}class="active"{% endif %}>Articles</a></li>
						<li><a href="{{ path('app_categorie_article_index') }}" {% if 'categorie_article' in app.request.get('_route') %}class="active"{% endif %}>Catégorie</a></li>
						<li><a href="{{ path('app_sortie_ai_index') }}" {% if 'sortie_ai' in app.request.get('_route') %}class="active"{% endif %}>Sorties IA</a></li>
					</ul>
					<i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
				</nav>

				{# User Actions Group #}
				<div class="d-flex align-items-center ms-auto gap-2">
					{% if app.user %}
						<div class="user-profile-pill d-none d-lg-flex align-items-center me-3 px-3 py-1 rounded-pill" style="background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease;">
							<div class="avatar-mini rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px; background-color: #d52e28; color: white; font-size: 0.7rem; font-weight: bold;">
								{{ app.user.prenom|first|upper|default('A') }}
							</div>
							<span class="text-white small fw-medium">Bonjour, <span class="fw-bold">{{ app.user.prenom ?? app.user.nom ?? 'Admin' }}</span></span>
						</div>
						
						<div class="auth-buttons d-flex gap-2">
							<a class="btn-getstarted m-0 d-flex align-items-center" href="{{ path('app_admin_dashboard') }}" style="padding: 8px 18px; white-space: nowrap; background-color: #102c59;">
								<i class="bi bi-house-door me-1"></i> Front Office
							</a>
							<a class="btn-getstarted m-0 d-flex align-items-center" href="{{ path('app_logout') }}" style="padding: 8px 18px; border-color: rgba(255,255,255,0.3);">
								<i class="bi bi-box-arrow-right me-1"></i> 
							</a>
						</div>
					{% else %}
						<a href="{{ path('app_login') }}" class="btn-getstarted m-0">
							<i class="bi bi-box-arrow-in-right me-1"></i> Connexion
						</a>
					{% endif %}
				</div>
			</div>
		</header>

		<main class="main">
			<!-- Messages flash pour les notifications -->
			{% for label, messages in app.flashes %}
				{% for message in messages %}
					<div class="alert alert-{{ label }} alert-dismissible fade show container mt-3" role="alert">
						{{ message }}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				{% endfor %}
			{% endfor %}

			{% block body %}{% endblock %}
		</main>

		<!-- ======= FOOTER ======= -->
		<footer id="footer" class="footer accent-background">
			<div class="container text-center">
				<p>© {{ "now"|date("Y") }} MentorAI. All Rights Reserved.</p>
			</div>
		</footer>

		<!-- Scroll Top -->
		<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
			<i class="bi bi-arrow-up-short"></i>
		</a>

		<!-- Preloader -->
		<div id="preloader"></div>

		<!-- Vendor JS -->
		<script src="{{ asset('assets/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
		<script src="{{ asset('assets/vendor/aos/aos.js') }}"></script>
		<script src="{{ asset('assets/vendor/purecounter/purecounter_vanilla.js') }}"></script>
		<script src="{{ asset('assets/vendor/swiper/swiper-bundle.min.js') }}"></script>

		<!-- Main JS -->
		<script src="{{ asset('assets/js/main.js') }}"></script>

		<!-- MentorUI Global Elements -->
		<div class="toast-container position-fixed bottom-0 end-0 p-3">
			<div id="mentorToast" class="toast premium-toast border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
				<div class="d-flex p-3">
					<div class="toast-icon-box me-3 rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
						<i class="bi fs-5"></i>
					</div>
					<div class="flex-grow-1">
						<h6 class="toast-title mb-1 fw-bold text-dark">Notification</h6>
						<div class="toast-message small text-secondary"></div>
					</div>
					<button type="button" class="btn-close ms-2" data-bs-dismiss="toast" aria-label="Close"></button>
				</div>
				<div class="toast-progress"><div class="toast-progress-inner"></div></div>
			</div>
		</div>

		<div class="modal fade" id="mentorConfirmModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-sm">
				<div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
					<div class="modal-body text-center p-4">
						<div class="confirm-icon-box mb-3 rounded-circle d-inline-flex align-items-center justify-content-center mx-auto" style="width: 70px; height: 70px;">
							<i class="bi fs-2"></i>
						</div>
						<h5 class="confirm-title fw-bold mb-2">Confirmation</h5>
						<p class="confirm-message text-muted small mb-0"></p>
					</div>
					<div class="modal-footer border-0 p-3 pt-0 d-flex gap-2">
						<button type="button" class="btn btn-light btn-sm rounded-pill flex-grow-1" data-bs-dismiss="modal">Annuler</button>
						<button type="button" id="mentor-confirm-btn" class="btn btn-primary btn-sm rounded-pill flex-grow-1">Confirmer</button>
					</div>
				</div>
			</div>
		</div>

		<script>
			window.MentorUI = {
				toast: function(type, title, message) {
					const toastEl = document.getElementById('mentorToast');
					const iconBox = toastEl.querySelector('.toast-icon-box');
					const progressInner = toastEl.querySelector('.toast-progress-inner');
					iconBox.className = 'toast-icon-box me-3 rounded-circle d-flex align-items-center justify-content-center';
					progressInner.style.animation = 'none';
					const configs = {
						success: { class: 'bg-soft-success', icon: 'bi-check-circle-fill', color: '#198754' },
						danger: { class: 'bg-soft-danger', icon: 'bi-exclamation-octagon-fill', color: '#dc3545' }
					};
					const config = configs[type] || configs.success;
					iconBox.classList.add(config.class);
					toastEl.querySelector('i').className = 'bi fs-5 ' + config.icon;
					toastEl.querySelector('.toast-title').textContent = title;
					toastEl.querySelector('.toast-message').textContent = message;
					progressInner.style.backgroundColor = config.color;
					const toast = new bootstrap.Toast(toastEl);
					void progressInner.offsetWidth;
					progressInner.style.animation = 'toast-progress-anim 5s linear forwards';
					toast.show();
				},
				confirm: function(options) {
					const modalEl = document.getElementById('mentorConfirmModal');
					const iconBox = modalEl.querySelector('.confirm-icon-box');
					const confirmBtn = document.getElementById('mentor-confirm-btn');
					const type = options.type || 'primary';
					const configs = {
						primary: { box: 'bg-light text-primary', icon: 'bi-question-circle', btn: 'btn-primary' },
						danger: { box: 'bg-soft-danger', icon: 'bi-exclamation-triangle', btn: 'btn-danger' }
					};
					const config = configs[type] || configs.primary;
					iconBox.className = 'confirm-icon-box mb-3 rounded-circle d-inline-flex align-items-center justify-content-center mx-auto ' + config.box;
					modalEl.querySelector('i').className = 'bi fs-2 ' + config.icon;
					modalEl.querySelector('.confirm-title').textContent = options.title || 'Confirmation';
					modalEl.querySelector('.confirm-message').textContent = options.message || 'Êtes-vous sûr ?';
					confirmBtn.className = 'btn btn-sm rounded-pill flex-grow-1 ' + config.btn;
					const modal = new bootstrap.Modal(modalEl);
					const handleConfirm = () => { if (options.onConfirm) options.onConfirm(); modal.hide(); confirmBtn.removeEventListener('click', handleConfirm); };
					confirmBtn.addEventListener('click', handleConfirm);
					modal.show();
				}
			};
		</script>

		{% block javascripts %}{% endblock %}
	</body>
</html>