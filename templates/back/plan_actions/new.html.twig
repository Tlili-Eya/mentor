{% extends 'back/basem.html.twig' %}

{% block title %}
    Nouveau Plan d'Action
{% endblock %}

{% block body %}
<div class="page-title" style="background-color: #9dbbce; padding: 20px 0;">
  <div class="container d-lg-flex justify-content-between align-items-center">
    <h1 class="mb-2 mb-lg-0" style="color: #102c59; font-weight: 700;">Nouveau Plan d'Action</h1>
    <nav class="breadcrumbs">
      <ol style="list-style: none; padding: 0; margin: 0; display: flex; gap: 10px;">
        <li><a href="{{ path('back_home') }}" style="color: #102c59; text-decoration: none;">Accueil</a></li>
        <li><a href="{{ path('app_plan_actions_index') }}" style="color: #102c59; text-decoration: none;">Plans d'Actions</a></li>
        <li style="color: #d52e28;">› Nouveau</li>
      </ol>
    </nav>
  </div>
</div>

<section class="section" style="padding: 40px 0;">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        
        <!-- Header avec titre principal -->
        <div class="text-center mb-5">
          <h2 class="mb-3" style="color: #102c59; font-weight: 700;">Créer un Nouveau Plan d'Action</h2>
          <p style="color: #102c59; opacity: 0.8;">Définissez votre plan d'action pour une meilleure gestion</p>
        </div>

        <div class="card" style="border: 1px solid #9dbbce; border-radius: 8px; box-shadow: 0 4px 12px rgba(16, 44, 89, 0.1);">
          <div class="card-body p-4">
            
            {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}
            
            <!-- Décision -->
            <div class="mb-4">
              <label class="form-label fw-bold" style="color: #102c59;">Décision <span style="color: #d52e28;">*</span></label>
              {{ form_widget(form.decision, {
                'attr': {
                  'class': 'form-control',
                  'placeholder': 'Ex: Mettre en place une nouvelle stratégie pédagogique',
                  'style': 'border-color: #9dbbce; border-radius: 6px;'
                }
              }) }}
              <div class="invalid-feedback" style="color: #d52e28;">
                {{ form_errors(form.decision) }}
              </div>
            </div>
            
            <!-- Description détaillée -->
            <div class="mb-4">
              <label class="form-label fw-bold" style="color: #102c59;">Description détaillée <span style="color: #d52e28;">*</span></label>
              {{ form_widget(form.description, {
                'attr': {
                  'class': 'form-control',
                  'rows': 4,
                  'placeholder': 'Rédigez le contenu complet du plan d\'action...',
                  'style': 'border-color: #9dbbce; border-radius: 6px;'
                }
              }) }}
              <div class="invalid-feedback" style="color: #d52e28;">
                {{ form_errors(form.description) }}
              </div>
            </div>
            
            <!-- Deux colonnes pour Statut et Catégorie -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label fw-bold" style="color: #102c59;">Statut <span style="color: #d52e28;">*</span></label>
                  {{ form_widget(form.statut, {
                    'attr': {
                      'class': 'form-select',
                      'style': 'border-color: #9dbbce; border-radius: 6px;'
                    }
                  }) }}
                  <div class="invalid-feedback" style="color: #d52e28;">
                    {{ form_errors(form.statut) }}
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label fw-bold" style="color: #102c59;">Catégorie <span style="color: #d52e28;">*</span></label>
                  {{ form_widget(form.categorie, {
                    'attr': {
                      'class': 'form-select',
                      'style': 'border-color: #9dbbce; border-radius: 6px;'
                    }
                  }) }}
                  <div class="invalid-feedback" style="color: #d52e28;">
                    {{ form_errors(form.categorie) }}
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Date -->
            <div class="mb-4">
              <label class="form-label fw-bold" style="color: #102c59;">Date <span style="color: #d52e28;">*</span></label>
              {{ form_widget(form.date, {
                'attr': {
                  'class': 'form-control',
                  'placeholder': 'jj/mm/aaaa',
                  'style': 'border-color: #9dbbce; border-radius: 6px;'
                }
              }) }}
              <div class="invalid-feedback" style="color: #d52e28;">
                {{ form_errors(form.date) }}
              </div>
            </div>
            
            <!-- Information note -->
            <div class="alert alert-info mt-4 mb-4" style="background-color: rgba(157, 187, 206, 0.2); border-color: #9dbbce; color: #102c59; border-left: 4px solid #102c59; border-radius: 6px;">
              <i class="bi bi-info-circle me-2" style="color: #102c59;"></i>
              <strong>Information :</strong> Ce plan d'action sera automatiquement attribué à l'administrateur connecté.
            </div>

            <!-- Boutons d'action -->
            <div class="d-flex justify-content-between mt-4 pt-3 border-top" style="border-color: #9dbbce !important;">
              <a href="{{ path('app_plan_actions_index') }}" class="btn" style="border: 1px solid #9dbbce; color: #102c59; border-radius: 6px; padding: 10px 25px;">
                <i class="bi bi-arrow-left me-1"></i> Retour à la liste
              </a>
              <button type="submit" class="btn" style="background-color: #102c59; color: white; border: none; border-radius: 6px; padding: 10px 25px; font-weight: 600;">
                <i class="bi bi-plus-circle me-1"></i> Créer le Plan
              </button>
            </div>
            
            {{ form_end(form) }}
            
          </div>
        </div>

        <!-- Navigation footer -->
        <div class="mt-4 text-center">
          <nav class="nav justify-content-center">
            <a class="nav-link" href="#" style="color: #102c59; opacity: 0.7;">
              <i class="bi bi-clipboard-check me-1"></i> Plan d'actions
            </a>
            <a class="nav-link" href="#" style="color: #102c59; opacity: 0.7;">
              <i class="bi bi-file-text me-1"></i> Articles
            </a>
            <a class="nav-link" href="#" style="color: #102c59; opacity: 0.7;">
              <i class="bi bi-tag me-1"></i> Catégorie
            </a>
            <a class="nav-link" href="#" style="color: #102c59; opacity: 0.7;">
              <i class="bi bi-window me-1"></i> Front Office
            </a>
          </nav>
        </div>
        
      </div>
    </div>
  </div>
</section>

<style>
.card {
  border-radius: 12px;
}

.form-label {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.form-control, .form-select {
  border: 2px solid #9dbbce;
  border-radius: 8px;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  border-color: #102c59;
  box-shadow: 0 0 0 0.25rem rgba(16, 44, 89, 0.25);
  outline: none;
}

.btn {
  padding: 0.75rem 2rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn[style*="background-color: #102c59"]:hover {
  background-color: #0a1f3f !important;
}

.btn[style*="border: 1px solid #9dbbce"]:hover {
  background-color: rgba(157, 187, 206, 0.1);
  color: #102c59;
}

.nav-link {
  font-weight: 500;
  transition: all 0.3s;
}

.nav-link:hover {
  color: #d52e28 !important;
  opacity: 1 !important;
}

.was-validated .form-control:invalid,
.was-validated .form-select:invalid {
  border-color: #d52e28;
}

.was-validated .form-control:valid,
.was-validated .form-select:valid {
  border-color: #28a745;
}

.invalid-feedback {
  display: none;
  width: 100%;
  margin-top: 0.25rem;
  font-size: 0.875em;
}

.was-validated .form-control:invalid ~ .invalid-feedback,
.was-validated .form-select:invalid ~ .invalid-feedback {
  display: block;
}

input[type="date"] {
  position: relative;
  padding-right: 2.5rem;
}

input[type="date"]::-webkit-calendar-picker-indicator {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  opacity: 0.7;
  color: #102c59;
}

input[type="date"]::-webkit-calendar-picker-indicator:hover {
  opacity: 1;
}

.form-select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23102c59' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px 12px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Validation côté client
  const forms = document.querySelectorAll('.needs-validation');
  
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      form.classList.add('was-validated');
    }, false);
  });
  
  // Formatage de la date
  const dateInput = document.querySelector('input[type="date"]');
  if (dateInput) {
    // Définir la date d'aujourd'hui par défaut
    if (!dateInput.value) {
      const today = new Date().toISOString().split('T')[0];
      dateInput.value = today;
    }
    
    // Améliorer l'apparence du champ date
    dateInput.style.cursor = 'pointer';
    
    // Ajouter un placeholder personnalisé
    if (!dateInput.hasAttribute('placeholder')) {
      dateInput.setAttribute('placeholder', 'Sélectionnez une date');
    }
    
    // Format d'affichage
    dateInput.addEventListener('change', function() {
      const date = new Date(this.value);
      if (!isNaN(date.getTime())) {
        // Formater la date en français
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const formatted = date.toLocaleDateString('fr-FR', options);
        
        // Créer un élément pour afficher la date formatée
        let displayElement = this.nextElementSibling;
        if (!displayElement || !displayElement.classList.contains('date-display')) {
          displayElement = document.createElement('div');
          displayElement.classList.add('date-display', 'mt-2', 'text-muted');
          displayElement.style.fontSize = '0.9rem';
          displayElement.style.color = '#102c59';
          displayElement.style.opacity = '0.7';
          this.parentNode.appendChild(displayElement);
        }
        displayElement.textContent = 'Date sélectionnée : ' + formatted;
      }
    });
    
    // Déclencher l'événement change au chargement si une date est déjà définie
    if (dateInput.value) {
      dateInput.dispatchEvent(new Event('change'));
    }
  }
  
  // Améliorer l'expérience des champs de formulaire
  const formControls = document.querySelectorAll('.form-control, .form-select');
  formControls.forEach(control => {
    // Ajouter un effet de focus amélioré
    control.addEventListener('focus', function() {
      this.parentElement.style.position = 'relative';
    });
    
    // Ajouter une animation de label flottant
    const label = control.previousElementSibling;
    if (label && label.classList.contains('form-label')) {
      control.addEventListener('focus', function() {
        label.style.color = '#102c59';
        label.style.fontWeight = '700';
      });
      
      control.addEventListener('blur', function() {
        if (!this.value) {
          label.style.color = '#102c59';
          label.style.fontWeight = '600';
        }
      });
    }
  });
});
</script>
{% endblock %}