{% extends 'back/basem.html.twig' %}

{% block title %}Modifier Article - {{ article.titre }}{% endblock %}

{% block body %}
<div class="page-title" style="background-color: #9dbbce; padding: 20px 0;">
  <div class="container d-lg-flex justify-content-between align-items-center">
    <h1 class="mb-2 mb-lg-0" style="color: #102c59; font-weight: 700;">Modifier Article</h1>
    <nav class="breadcrumbs">
      <ol style="list-style: none; padding: 0; margin: 0; display: flex; gap: 10px;">
        <li><a href="{{ path('back_home') }}" style="color: #102c59; text-decoration: none;">Accueil</a></li>
        <li><a href="{{ path('app_reference_article_index') }}" style="color: #102c59; text-decoration: none;">Articles</a></li>
        <li style="color: #d52e28;">› Modifier</li>
      </ol>
    </nav>
  </div>
</div>

<section class="section" style="padding: 40px 0;">
  <div class="container">
    
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card" style="border: 1px solid #9dbbce; border-radius: 8px; box-shadow: 0 4px 12px rgba(16, 44, 89, 0.1);">
          <div class="card-body p-4">
            
            <div class="text-center mb-4">
              <h2 class="mb-1" style="color: #102c59;">Modifier l'Article</h2>
              <p style="color: #102c59; opacity: 0.8;">Mettez à jour le contenu de l'article</p>
            </div>

            <form method="post" class="needs-validation" novalidate>
              {{ form_start(form) }}
              
              <div class="mb-4">
                <label for="{{ form.titre.vars.id }}" class="form-label fw-bold" style="color: #102c59;">
                  Titre de l'article <span style="color: #d52e28;">*</span>
                </label>
                {{ form_widget(form.titre, {
                  'attr': {
                    'class': 'form-control' ~ (form.titre.vars.errors|length ? ' is-invalid' : ''),
                    'placeholder': 'Ex: Les meilleures pratiques pédagogiques en 2025',
                    'style': 'border-color: #9dbbce; border-radius: 6px;'
                  }
                }) }}
                <div class="invalid-feedback" style="color: #d52e28;">
                  {{ form_errors(form.titre) }}
                </div>
              </div>

              <div class="mb-4">
                <label for="{{ form.contenu.vars.id }}" class="form-label fw-bold" style="color: #102c59;">
                  Contenu de l'article <span style="color: #d52e28;">*</span>
                </label>
                {{ form_widget(form.contenu, {
                  'attr': {
                    'class': 'form-control' ~ (form.contenu.vars.errors|length ? ' is-invalid' : ''),
                    'rows': '10',
                    'placeholder': 'Rédigez le contenu complet de l\'article...',
                    'style': 'border-color: #9dbbce; border-radius: 6px;'
                  }
                }) }}
                <div class="invalid-feedback" style="color: #d52e28;">
                  {{ form_errors(form.contenu) }}
                </div>
              </div>

              <div class="row mb-4">
                <div class="col-md-6">
                  <label for="{{ form.categorie.vars.id }}" class="form-label fw-bold" style="color: #102c59;">
                    Catégorie <span style="color: #d52e28;">*</span>
                  </label>
                  {{ form_widget(form.categorie, {
                    'attr': {
                      'class': 'form-select' ~ (form.categorie.vars.errors|length ? ' is-invalid' : ''),
                      'placeholder': 'Sélectionnez une catégorie',
                      'style': 'border-color: #9dbbce; border-radius: 6px;'
                    }
                  }) }}
                  <div class="invalid-feedback" style="color: #d52e28;">
                    {{ form_errors(form.categorie) }}
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold d-block" style="color: #102c59; margin-bottom: 15px;">
                    Statut
                  </label>
                  <div class="form-check form-switch" style="padding-left: 3.5rem;">
                    {{ form_widget(form.published, {
                      'attr': {
                        'class': 'form-check-input' ~ (form.published.vars.errors|length ? ' is-invalid' : ''),
                        'role': 'switch',
                        'style': 'width: 3rem; height: 1.5rem; margin-left: -3.5rem;'
                      }
                    }) }}
                    <label class="form-check-label" for="{{ form.published.vars.id }}" style="color: #102c59; font-weight: 500;">
                      Publier l'article
                    </label>
                    <div class="invalid-feedback" style="color: #d52e28;">
                      {{ form_errors(form.published) }}
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-4 p-3 rounded" style="background-color: rgba(157, 187, 206, 0.1); border: 1px solid #9dbbce;">
                <h6 class="fw-bold" style="color: #102c59; margin-bottom: 15px;">
                  <i class="bi bi-info-circle me-2" style="color: #102c59;"></i>
                  Informations système
                </h6>
                <div class="row">
                  <div class="col-md-6">
                    <p class="mb-1"><small style="color: #102c59; opacity: 0.7;">Créé par:</small></p>
                    <p style="color: #102c59; font-weight: 500;">
                      {% if article.auteur %}
                        {{ article.auteur.nom }} {{ article.auteur.prenom }}
                      {% else %}
                        Non spécifié
                      {% endif %}
                    </p>
                  </div>
                  <div class="col-md-6">
                    <p class="mb-1"><small style="color: #102c59; opacity: 0.7;">Créé le:</small></p>
                    <p style="color: #102c59; font-weight: 500;">{{ article.createdAt ? article.createdAt|date('d/m/Y H:i') : 'Non spécifié' }}</p>
                  </div>
                </div>
                {% if article.updatedAt %}
                <div class="row mt-2">
                  <div class="col-md-12">
                    <p class="mb-1"><small style="color: #102c59; opacity: 0.7;">Dernière modification:</small></p>
                    <p style="color: #102c59; font-weight: 500;">{{ article.updatedAt|date('d/m/Y H:i') }}</p>
                  </div>
                </div>
                {% endif %}
              </div>

              <div class="d-flex justify-content-between mt-4 pt-3 border-top" style="border-color: #9dbbce !important;">
                <a href="{{ path('app_reference_article_index') }}" class="btn" style="border: 1px solid #9dbbce; color: #102c59; border-radius: 6px; padding: 10px 25px;">
                  <i class="bi bi-arrow-left me-1"></i> Annuler
                </a>
                <button type="submit" class="btn" style="background-color: #d52e28; color: white; border: none; border-radius: 6px; padding: 10px 25px; font-weight: 600;">
                  <i class="bi bi-check-circle me-1"></i> Enregistrer
                </button>
              </div>

              {{ form_end(form) }}
            </form>
            
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<style>
.card {
  border-radius: 12px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(16, 44, 89, 0.15);
}

.form-label {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.75rem;
}

.form-control, .form-select {
  border: 2px solid #9dbbce;
  border-radius: 8px;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  border-color: #102c59;
  box-shadow: 0 0 0 0.25rem rgba(16, 44, 89, 0.25);
  outline: none;
}

.btn {
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn[style*="background-color: #d52e28"]:hover {
  background-color: #b32520 !important;
}

.btn[style*="border: 1px solid #9dbbce"]:hover {
  background-color: rgba(157, 187, 206, 0.1);
  color: #102c59;
}

/* Style pour le switch de publication */
.form-check-input {
  border-color: #9dbbce;
  background-color: #f8f9fa;
}

.form-check-input:checked {
  background-color: #102c59;
  border-color: #102c59;
}

.form-check-input:focus {
  border-color: #9dbbce;
  box-shadow: 0 0 0 0.25rem rgba(157, 187, 206, 0.25);
}

.was-validated .form-control:invalid,
.was-validated .form-select:invalid,
.was-validated .form-check-input:invalid {
  border-color: #d52e28;
}

.was-validated .form-control:valid,
.was-validated .form-select:valid {
  border-color: #28a745;
}

.invalid-feedback {
  display: none;
  width: 100%;
  margin-top: 0.25rem;
  font-size: 0.875em;
}

.was-validated .form-control:invalid ~ .invalid-feedback,
.was-validated .form-select:invalid ~ .invalid-feedback,
.was-validated .form-check-input:invalid ~ .invalid-feedback {
  display: block;
}

.bi {
  vertical-align: middle;
}

.rounded {
  border-radius: 8px;
}

.border-top {
  border-top-width: 2px !important;
}

/* Style pour le textarea */
textarea.form-control {
  min-height: 200px;
  resize: vertical;
}

/* Animation pour les champs */
.form-control, .form-select, .form-check-input {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Style pour le select */
.form-select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23102c59' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px 12px;
}

/* Style pour les états disabled */
.form-control:disabled,
.form-select:disabled {
  background-color: rgba(157, 187, 206, 0.2);
  border-color: rgba(157, 187, 206, 0.5);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Validation côté client
  const forms = document.querySelectorAll('.needs-validation');
  
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
  
  // Animation d'entrée pour la carte
  const card = document.querySelector('.card');
  if (card) {
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, 100);
  }
  
  // Améliorer l'expérience du textarea
  const textarea = document.querySelector('textarea');
  if (textarea) {
    // Ajouter un compteur de caractères
    const charCount = document.createElement('div');
    charCount.className = 'form-text mt-2';
    charCount.style.color = '#102c59';
    charCount.style.opacity = '0.7';
    charCount.style.fontSize = '0.875rem';
    textarea.parentNode.appendChild(charCount);
    
    function updateCharCount() {
      const length = textarea.value.length;
      charCount.textContent = `${length} caractères`;
      
      // Changer la couleur selon la longueur
      if (length > 5000) {
        charCount.style.color = '#28a745';
      } else if (length > 1000) {
        charCount.style.color = '#102c59';
      } else {
        charCount.style.color = '#d52e28';
      }
    }
    
    textarea.addEventListener('input', updateCharCount);
    updateCharCount(); // Initialiser
    
    // Ajouter un effet de focus amélioré
    textarea.addEventListener('focus', function() {
      this.parentElement.style.position = 'relative';
      this.style.borderColor = '#102c59';
      this.style.boxShadow = '0 0 0 0.25rem rgba(16, 44, 89, 0.1)';
    });
    
    textarea.addEventListener('blur', function() {
      this.style.boxShadow = 'none';
      this.style.borderColor = '#9dbbce';
    });
  }
  
  // Améliorer le switch de publication
  const publishSwitch = document.querySelector('.form-check-input[type="checkbox"]');
  if (publishSwitch) {
    const switchLabel = publishSwitch.nextElementSibling;
    if (switchLabel) {
      // Ajouter un indicateur visuel
      const indicator = document.createElement('span');
      indicator.className = 'badge ms-2';
      indicator.style.backgroundColor = publishSwitch.checked ? '#28a745' : '#6c757d';
      indicator.style.color = 'white';
      indicator.textContent = publishSwitch.checked ? 'PUBLIÉ' : 'BROUILLON';
      switchLabel.appendChild(indicator);
      
      // Mettre à jour l'indicateur quand le switch change
      publishSwitch.addEventListener('change', function() {
        indicator.textContent = this.checked ? 'PUBLIÉ' : 'BROUILLON';
        indicator.style.backgroundColor = this.checked ? '#28a745' : '#6c757d';
      });
    }
  }
  
  // Effet de confirmation pour le bouton d'enregistrement
  const saveButton = document.querySelector('button[type="submit"]');
  if (saveButton) {
    saveButton.addEventListener('mouseover', function() {
      this.style.boxShadow = '0 4px 8px rgba(213, 46, 40, 0.3)';
    });
    
    saveButton.addEventListener('mouseout', function() {
      this.style.boxShadow = 'none';
    });
    
    saveButton.addEventListener('click', function(e) {
      // Vérifier si le formulaire est valide
      const form = this.closest('form');
      if (form.checkValidity()) {
        // Animation de confirmation
        this.innerHTML = '<i class="bi bi-check2-circle me-1"></i> Enregistrement...';
        this.style.backgroundColor = '#28a745';
        
        setTimeout(() => {
          this.innerHTML = '<i class="bi bi-check-circle me-1"></i> Enregistré !';
        }, 1000);
      }
    });
  }
  
  // Ajouter un placeholder dynamique au select
  const categorySelect = document.querySelector('select');
  if (categorySelect && !categorySelect.value) {
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    defaultOption.textContent = 'Sélectionnez une catégorie';
    categorySelect.insertBefore(defaultOption, categorySelect.firstChild);
  }
});
</script>
{% endblock %}