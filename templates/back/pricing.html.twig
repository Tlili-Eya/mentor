{% extends 'back/base.html.twig' %}

{% block title %}Transactions Stripe | MentorAI
{% endblock %}

{% block stylesheets %}
	<style>
		.transaction-card {
			background: white;
			border-radius: 15px;
			overflow: hidden;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
			border: none;
			margin-bottom: 30px;
		}

		.card-header-premium {
			background: linear-gradient(135deg, #102c59 0%, #0a1a36 100%);
			color: white;
			padding: 20px 25px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.card-header-premium h2 {
			margin: 0;
			font-size: 1.5rem;
			font-weight: 600;
			color: #9dbbce;
		}

		.stripe-badge {
			background: rgba(255, 255, 255, 0.1);
			padding: 5px 12px;
			border-radius: 20px;
			font-size: 0.8rem;
			border: 1px solid rgba(157, 187, 206, 0.3);
		}

		.table-premium {
			margin-bottom: 0;
		}

		.table-premium th {
			background-color: #f8f9fa;
			color: #102c59;
			font-weight: 600;
			text-transform: uppercase;
			font-size: 0.75rem;
			letter-spacing: 1px;
			padding: 15px 25px;
			border-top: none;
		}

		.table-premium td {
			padding: 18px 25px;
			vertical-align: middle;
			color: #4a5568;
			border-bottom: 1px solid #edf2f7;
		}

		.status-badge {
			padding: 6px 12px;
			border-radius: 50px;
			font-size: 0.75rem;
			font-weight: 600;
			text-transform: capitalize;
		}

		.status-succeeded {
			background-color: #c6f6d5;
			color: #22543d;
		}

		.status-pending {
			background-color: #feebc8;
			color: #744210;
		}

		.status-failed {
			background-color: #fed7d7;
			color: #822727;
		}

		.amount-text {
			font-weight: 700;
			color: #102c59;
		}

		.currency-text {
			font-size: 0.8rem;
			color: #718096;
			margin-left: 2px;
		}

		.email-text {
			font-weight: 500;
			color: #2d3748;
		}

		.date-text {
			color: #718096;
			font-size: 0.85rem;
		}

		.empty-state {
			padding: 60px;
			text-align: center;
			background: white;
			border-radius: 15px;
		}

		.empty-state i {
			font-size: 4rem;
			color: #cbd5e0;
			margin-bottom: 20px;
		}

		.stats-container {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}

		.stat-card {
			background: white;
			padding: 20px;
			border-radius: 12px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
			border-left: 4px solid #9dbbce;
		}

		.stat-label {
			font-size: 0.8rem;
			color: #718096;
			text-transform: uppercase;
			margin-bottom: 5px;
		}

		.stat-value {
			font-size: 1.5rem;
			font-weight: 700;
			color: #102c59;
		}
	</style>
{% endblock %}

{% block body %}
	<div class="container-fluid py-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<div>
				<h1 class="h3 mb-1 font-weight-bold text-dark">Gestion des Revenus</h1>
				<p class="text-muted small">Visualisation des transactions via l'API Stripe</p>
			</div>
			<div class="d-flex gap-2">
				<button class="btn btn-outline-primary btn-sm" onclick="window.location.reload()">
					<i class="bi bi-arrow-clockwise"></i>
					Actualiser
				</button>
				<a href="https://dashboard.stripe.com/" target="_blank" class="btn btn-primary btn-sm">
					<i class="bi bi-box-arrow-up-right"></i>
					Dashboard Stripe
				</a>
			</div>
		</div>

		{% if transactions is not empty %}
			<div class="stats-container">
				<div class="stat-card">
					<div class="stat-label">Total Transactions</div>
					<div class="stat-value">{{ transactions|length }}</div>
				</div>
				<div class="stat-card">
					<div class="stat-label">Volume de Transaction</div>
					{% set total_amount = 0 %}
					{% for t in transactions %}
						{% if t.status == 'succeeded' %}
							{% set total_amount = total_amount + t.amount %}
						{% endif %}
					{% endfor %}
					<div class="stat-value text-success">{{ total_amount|number_format(2, ',', ' ') }}
						<span class="fs-6">EUR</span>
					</div>
				</div>
				<div class="stat-card" style="border-left-color: #28a745;">
					<div class="stat-label">Réussies</div>
					<div class="stat-value text-success">{{ transactions|filter(t => t.status == 'succeeded')|length }}</div>
				</div>
				<div class="stat-card" style="border-left-color: #d52e28;">
					<div class="stat-label">Échouées</div>
					<div class="stat-value text-danger">{{ transactions|filter(t => t.status == 'failed')|length }}</div>
				</div>
			</div>

			<div class="transaction-card">
				<div class="card-header-premium">
					<h2>
						<i class="bi bi-credit-card-2-back me-2"></i>
						Historique des Paiements</h2>
					<div class="stripe-badge">
						<i class="bi bi-stripe me-1"></i>
						Live Mode
					</div>
				</div>
				<div class="table-responsive">
					<table class="table table-premium">
						<thead>
							<tr>
								<th>ID Transaction</th>
								<th>Client / Email</th>
								<th>Description</th>
								<th>Montant</th>
								<th>Statut</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody>
							{% for t in transactions %}
								<tr>
									<td class="text-muted small">{{ t.id }}</td>
									<td>
										<div class="email-text">{{ t.email }}</div>
									</td>
									<td>
										<div class="text-truncate" style="max-width: 200px;" title="{{ t.description }}">
											{{ t.description }}
										</div>
									</td>
									<td>
										<span class="amount-text">{{ t.amount|number_format(2, ',', ' ') }}</span>
										<span class="currency-text">{{ t.currency }}</span>
									</td>
									<td>
										<span class="status-badge status-{{ t.status }}">
											{% if t.status == 'succeeded' %}
												<i class="bi bi-check-circle-fill me-1"></i>
											{% elseif t.status == 'pending' %}
												<i class="bi bi-clock-history me-1"></i>
											{% elseif t.status == 'failed' %}
												<i class="bi bi-x-circle-fill me-1"></i>
											{% endif %}
											{{ t.status }}
										</span>
									</td>
									<td>
										<div class="date-text">
											<i class="bi bi-calendar3 me-1"></i>
											{{ t.created }}
										</div>
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		{% else %}
			<div class="empty-state">
				<i class="bi bi-card-list"></i>
				<h3>Aucune transaction trouvée</h3>
				<p class="text-muted">Il n'y a pas encore de transactions enregistrées sur ce compte Stripe ou la configuration est incorrecte.</p>
				<a href="https://dashboard.stripe.com/test/payments" target="_blank" class="btn btn-outline-primary mt-3">
					Consulter sur Stripe
				</a>
			</div>
		{% endif %}
	</div>
{% endblock %}
