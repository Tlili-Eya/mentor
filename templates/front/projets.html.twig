{% extends 'front/base.html.twig' %}

{% block title %}Mes Projets
{% endblock %}

{% block body %}
	<style>:root
	{
		--color-primary: #102c59;
		--color-secondary: #9dbbce;
		--color-danger: #d52e28;
	}

	.text-primary-custom {
		color: var(--color-primary) !important;
	}
	.bg-primary-custom {
		background-color: var(--color-primary) !important;
	}
	.btn-primary-custom {
		background-color: var(--color-primary);
		border-color: var(--color-primary);
		color: white;
	}
	.btn-primary-custom:hover {
		background-color: #0d244b;
		border-color: #0d244b;
		color: white;
	}

	.btn-danger-custom {
		background-color: var(--color-danger);
		border-color: var(--color-danger);
		color: white;
	}
	.btn-danger-custom:hover {
		background-color: #b92b25;
		border-color: #b92b25;
		color: white;
	}

	.btn-outline-danger-custom {
		color: var(--color-danger);
		border-color: var(--color-danger);
	}
	.btn-outline-danger-custom:hover {
		background-color: var(--color-danger);
		color: white;
	}

	.list-group-item.active {
		background-color: var(--color-primary);
		border-color: var(--color-primary);
	}

	.card-header-custom {
		background-color: var(--color-secondary);
		color: var(--color-primary);
	}

	.sidebar-custom {
		border-right: 1px solid var(--color-secondary);
	}
</style>

<div class="page-title" data-aos="fade" style="background-color: var(--color-primary); color: white;">
	<div class="heading">
		<div class="container">
			<div class="row d-flex justify-content-center text-center">
				<div class="col-lg-8">
					<h1 class="text-white">Gestion des Projets</h1>
					<p class="mb-0 text-white-50">Gérez vos projets académiques et professionnels, ainsi que les ressources associées.</p>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container mt-5 mb-5">
	<div
		class="row">
		<!-- Sidebar: Liste des Projets -->
		<div class="col-md-3 sidebar-custom pt-3">
			<div class="d-grid gap-2 mb-3">
				<a href="{{ path('front_projets', {'id': 0}) }}" class="btn btn-warning text-white fw-bold {{ activeProject is null or activeProject.id is null ? 'active' : '' }}">
					<i class="bi bi-plus-circle"></i>
					Nouveau Projet
				</a>
			</div>
			<div class="list-group shadow-sm">
				{% for project in projects %}
					<a href="{{ path('front_projets', {'id': project.id}) }}" class="list-group-item list-group-item-action {{ activeProject and activeProject.id == project.id ? 'active' : '' }}">
						<div class="d-flex w-100 justify-content-between">
							<h6 class="mb-1 text-truncate">{{ project.titre }}</h6>
						</div>
						<small class="{{ activeProject and activeProject.id == project.id ? 'text-white-50' : 'text-muted' }}">{{ project.type }}</small>
					</a>
				{% endfor %}
				{% if projects is empty %}
					<div class="list-group-item text-muted text-center">
						<small>Aucun projet enregistré</small>
					</div>
				{% endif %}
			</div>
		</div>

		<!-- Main Content -->
		<div
			class="col-md-9 pt-3">
			<!-- Formulaire Projet -->
			<div class="card shadow-sm mb-4 border-0">
				<div class="card-header card-header-custom d-flex justify-content-between align-items-center">
					<h5 class="mb-0 fw-bold">
						<i class="bi bi-folder"></i>
						{{ activeProject and activeProject.id ? 'Modifier le projet' : 'Créer un nouveau projet' }}</h5>
					{% if activeProject and activeProject.id %}
						<a href="{{ path('front_delete_project', {'id': activeProject.id}) }}" class="btn btn-danger-custom btn-sm" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce projet ? Cette action est irréversible.');">
							<i class="bi bi-trash"></i>
							Supprimer
						</a>
					{% endif %}
				</div>
				<div class="card-body">
					{{ form_start(projectForm, {'attr': {'novalidate': 'novalidate'}}) }}
					<div class="row">
						<div class="col-md-6 mb-3">
							{{ form_label(projectForm.titre, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
							{{ form_widget(projectForm.titre) }}
							{{ form_errors(projectForm.titre) }}
						</div>
						<div class="col-md-6 mb-3">
							{{ form_label(projectForm.type, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
							{{ form_widget(projectForm.type) }}
							{{ form_errors(projectForm.type) }}
						</div>
					</div>
					<div class="mb-3">
						{{ form_label(projectForm.description, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
						{{ form_widget(projectForm.description) }}
						{{ form_errors(projectForm.description) }}
					</div>
					<div class="mb-3">
						{{ form_label(projectForm.technologies, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
						{{ form_widget(projectForm.technologies) }}
						{{ form_errors(projectForm.technologies) }}
					</div>
					<div class="row">
						<div class="col-md-6 mb-3">
							{{ form_label(projectForm.dateDebut, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
							{{ form_widget(projectForm.dateDebut) }}
							{{ form_errors(projectForm.dateDebut) }}
						</div>
						<div class="col-md-6 mb-3">
							{{ form_label(projectForm.dateFin, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
							{{ form_widget(projectForm.dateFin) }}
							{{ form_errors(projectForm.dateFin) }}
						</div>
					</div>
					<div class="mb-3">
						{{ form_label(projectForm.parcours, null, {'label_attr': {'class': 'fw-bold text-primary-custom'}}) }}
						{{ form_widget(projectForm.parcours) }}
						{{ form_errors(projectForm.parcours) }}
					</div>

					<div class="d-flex justify-content-end">
						<button type="submit" class="btn btn-primary-custom px-4">
							<i class="bi bi-save"></i>
							{{ activeProject and activeProject.id ? 'Mettre à jour' : 'Enregistrer' }}
						</button>
					</div>
					{{ form_end(projectForm) }}
				</div>
			</div>

			<!-- Ressources Section (Seulement si projet existant) -->
			{% if activeProject and activeProject.id %}
				<div class="card shadow-sm border-0 mt-5">
					<div class="card-header bg-light border-bottom border-2" style="border-color: var(--color-secondary) !important;">
						<h5 class="mb-0 text-primary-custom">
							<i class="bi bi-files"></i>
							Ressources du projet</h5>
					</div>
					<div class="card-body">
						{% if activeProject.ressources is empty %}
							<div class="text-center py-4 text-muted">
								<i class="bi bi-folder2-open display-4" style="color: var(--color-secondary);"></i>
								<p class="mt-2">Aucune ressource associée pour le moment.</p>
							</div>
						{% else %}
							<div class="table-responsive">
								<table class="table table-hover align-middle">
									<thead style="background-color: var(--color-secondary); color: var(--color-primary);">
										<tr>
											<th>Type</th>
											<th>Nom</th>
											<th>Description</th>
											<th class="text-end">Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for resource in activeProject.ressources %}
											<tr>
												<td>
													<span class="badge" style="background-color: var(--color-primary);">{{ resource.typeRessource.value }}</span>
												</td>
												<td>
													<a href="{{ resource.urlRessource }}" target="_blank" class="text-decoration-none fw-bold" style="color: var(--color-primary);">
														{{ resource.nom }}
														<i class="bi bi-box-arrow-up-right small"></i>
													</a>
												</td>
												<td>{{ resource.description|default('-') }}</td>
												<td class="text-end">
													<a href="{{ path('front_projets', {'id': activeProject.id, 'resource_id': resource.id}) }}" class="btn btn-sm btn-outline-primary me-1">
														<i class="bi bi-pencil"></i>
													</a>
													<a href="{{ path('front_delete_ressource', {'id': resource.id}) }}" class="btn btn-sm btn-outline-danger-custom" onclick="return confirm('Supprimer cette ressource ?');">
														<i class="bi bi-trash"></i>
													</a>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						{% endif %}

						<hr class="my-4" style="color: var(--color-secondary);">

						<div class="d-flex justify-content-between align-items-center mb-3">
							<h6 class="mb-0 text-primary-custom">
								<i class="bi {{ resourceForm.vars.value.id ? 'bi-pencil-square' : 'bi-plus-lg' }}"></i>
								{{ resourceForm.vars.value.id ? 'Modifier la ressource' : 'Ajouter une ressource' }}
							</h6>
							{% if resourceForm.vars.value.id %}
								<a href="{{ path('front_projets', {'id': activeProject.id}) }}" class="btn btn-sm btn-outline-secondary">
									<i class="bi bi-x-circle"></i>
									Annuler
								</a>
							{% endif %}
						</div>

						<div class="p-4 rounded border" style="background-color: #f8f9fa; border-color: var(--color-secondary) !important;">
							{{ form_start(resourceForm, {'attr': {'novalidate': 'novalidate'}}) }}
							<div class="row">
								<div class="col-md-6 mb-3">
									{{ form_label(resourceForm.nom, null, {'label_attr': {'class': 'text-primary-custom'}}) }}
									{{ form_widget(resourceForm.nom) }}
								</div>
								<div class="col-md-6 mb-3">
									{{ form_label(resourceForm.typeRessource, null, {'label_attr': {'class': 'text-primary-custom'}}) }}
									{{ form_widget(resourceForm.typeRessource) }}
								</div>
							</div>
							<div class="mb-3">
								{{ form_label(resourceForm.urlRessource, null, {'label_attr': {'class': 'text-primary-custom'}}) }}
								{{ form_widget(resourceForm.urlRessource) }}
							</div>
							<div class="mb-3">
								{{ form_label(resourceForm.description, null, {'label_attr': {'class': 'text-primary-custom'}}) }}
								{{ form_widget(resourceForm.description) }}
								<div class="text-end">
									<button type="submit" class="btn btn-outline-primary" style="color: var(--color-primary); border-color: var(--color-primary);">
										<i class="bi {{ resourceForm.vars.value.id ? 'bi-save' : 'bi-plus-circle' }}"></i>
										{{ resourceForm.vars.value.id ? 'Mettre à jour' : 'Ajouter la ressource' }}
									</button>
								</div>
								{{ form_end(resourceForm) }}
							</div>
						</div>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
